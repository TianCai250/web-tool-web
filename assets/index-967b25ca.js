import{_ as D,C as P,a as B,B as J,D as U,t as V,b as g,o as i,d as h,e as a,f as _,u as l,i as M,w as f,F as A,s as H,E as O,j as v,G as R,x as S,H as Y,I as G,k as F}from"./index-02cdd310.js";const Q={class:"ai-chat"},Z={class:"question-container"},K={class:"question-btn"},L={class:"answer-container"},W={class:"answer-list"},X={class:"answer-icon"},tt={class:"answer-words"},et="a7f148b0",st="MzNjZDEzYjkxNTE5YjQ3MjU2YmZiNTUx",ot="a894f8068c0dced62fd3df07d48c91de",nt={__name:"index",setup(at){const y=P().appContext.config.globalProperties.$CryptoJS,t=B({question:"",list:[],status:"empty"});J(()=>{const s=$();if(s)try{t.list=JSON.parse(s)}catch(o){console.log(o)}});const b=U(()=>t.question.trim().length===0||["busy"].includes(t.status)),w=()=>{b.value||(t.status="busy",t.list.push({role:"user",content:t.question}),t.question="",x(),k().then(s=>{}))},k=()=>new Promise((s,o)=>{const r=new Date().toGMTString(),n="spark-api.xf-yun.com",u="/v3.5/chat";let e=`host: ${n}
date: ${r}
GET ${u} HTTP/1.1`,m=y.enc.Base64.stringify(y.HmacSHA256(e,st));const q=`api_key="${ot}", algorithm="hmac-sha256", headers="host date request-line", signature="${m}"`;let T=btoa(q);const j=`wss://${n}${u}?authorization=${T}&date=${encodeURIComponent(r)}&host=${n}`;let c=new WebSocket(j);c.onopen=function(){console.log("sock连接成功!!!!"),c.send(JSON.stringify({header:{app_id:et},parameter:{chat:{domain:"generalv3.5",temperature:.5,max_tokens:1024}},payload:{message:{text:t.list}}})),t.list.push({role:"assistant",content:""})},c.onerror=function(d){t.status="empty",console.log("error: ",d),O({type:"error",message:"网络异常"}),o(d)},c.onmessage=function(d){JSON.parse(d.data).payload.choices.text.forEach(z=>{t.list[t.list.length-1].content+=z.content})},c.onclose=function(){t.status="empty",x(),s(t.list)}}),C=()=>{t.list=[],E()},x=()=>{localStorage.setItem("web_tool_ai_chat",JSON.stringify(t.list))},$=()=>localStorage.getItem("web_tool_ai_chat"),E=()=>{localStorage.removeItem("web_tool_ai_chat")},{question:p,list:I,status:N}=V(t);return(s,o)=>{const r=g("el-input"),n=g("el-button"),u=g("el-icon");return i(),h("div",Q,[a("div",Z,[_(r,{type:"textarea",rows:4,resize:"none",placeholder:"请开始您的对话",modelValue:l(p),"onUpdate:modelValue":o[0]||(o[0]=e=>M(p)?p.value=e:null),clearable:""},null,8,["modelValue"]),a("div",K,[_(n,{onClick:C,disabled:l(N)!=="empty"},{default:f(()=>[v("全新会话")]),_:1},8,["disabled"]),_(n,{type:"info",onClick:w,disabled:b.value},{default:f(()=>[v("发送")]),_:1},8,["disabled"])])]),a("div",L,[a("div",W,[(i(!0),h(A,null,H(l(I),(e,m)=>(i(),h("div",{class:R(["answer-item",{user:e.role==="user",system:e.role==="assistant"}]),key:m},[a("div",X,[_(u,null,{default:f(()=>[e.role==="user"?(i(),S(l(Y),{key:0})):(i(),S(l(G),{key:1}))]),_:2},1024)]),a("div",tt,F(e.content===""?"...":e.content),1)],2))),128))])])])}}},ut=D(nt,[["__scopeId","data-v-ba1512e7"]]);export{ut as default};
