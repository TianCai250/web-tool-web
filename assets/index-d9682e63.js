import v from"crypto-js";import{_ as B,a as P,A as U,B as V,t as A,b as h,o as l,d as g,e as o,f as d,u as r,i as J,w as f,F as M,s as O,E as R,j as x,C as Y,x as w,D as G,G as H,k as F}from"./index-f6a3eef9.js";const Q={class:"ai-chat"},Z={class:"question-container"},K={class:"question-btn"},L={class:"answer-container"},W={class:"answer-list"},X={class:"answer-icon"},tt={class:"answer-words"},et="a7f148b0",st="MzNjZDEzYjkxNTE5YjQ3MjU2YmZiNTUx",ot="a894f8068c0dced62fd3df07d48c91de",nt={__name:"index",setup(at){const t=P({question:"",list:[],status:"empty"});U(()=>{const n=E();if(n)try{t.list=JSON.parse(n)}catch(s){console.log(s)}});const y=V(()=>t.question.trim().length===0||["busy"].includes(t.status)),S=()=>{y.value||(t.question="",t.status="busy",t.list.push({role:"user",content:t.question}),b(),k(t.question).then(n=>{}))},k=n=>new Promise((s,p)=>{const a=new Date().toGMTString(),i="spark-api.xf-yun.com",e="/v3.5/chat";let m=`host: ${i}
date: ${a}
GET ${e} HTTP/1.1`,I=v.enc.Base64.stringify(v.HmacSHA256(m,st));const T=`api_key="${ot}", algorithm="hmac-sha256", headers="host date request-line", signature="${I}"`;let j=btoa(T);const z=`wss://${i}${e}?authorization=${j}&date=${encodeURIComponent(a)}&host=${i}`;let c=new WebSocket(z);c.onopen=function(){console.log("sock连接成功!!!!"),c.send(JSON.stringify({header:{app_id:et},parameter:{chat:{domain:"generalv3.5",temperature:.5,max_tokens:1024}},payload:{message:{text:t.list}}})),t.list.push({role:"assistant",content:""})},c.onerror=function(u){t.status="empty",console.log("error: ",u),R({type:"error",message:"网络异常"}),p(u)},c.onmessage=function(u){JSON.parse(u.data).payload.choices.text.forEach(D=>{t.list[t.list.length-1].content+=D.content})},c.onclose=function(){t.status="empty",b(),s(t.list)}}),q=()=>{t.list=[],N()},b=()=>{localStorage.setItem("web_tool_ai_chat",JSON.stringify(t.list))},E=()=>localStorage.getItem("web_tool_ai_chat"),N=()=>{localStorage.removeItem("web_tool_ai_chat")},{question:_,list:$,status:C}=A(t);return(n,s)=>{const p=h("el-input"),a=h("el-button"),i=h("el-icon");return l(),g("div",Q,[o("div",Z,[d(p,{type:"textarea",rows:4,resize:"none",placeholder:"请开始您的对话",modelValue:r(_),"onUpdate:modelValue":s[0]||(s[0]=e=>J(_)?_.value=e:null),clearable:""},null,8,["modelValue"]),o("div",K,[d(a,{onClick:q,disabled:r(C)!=="empty"},{default:f(()=>[x("全新会话")]),_:1},8,["disabled"]),d(a,{type:"info",onClick:S,disabled:y.value},{default:f(()=>[x("发送")]),_:1},8,["disabled"])])]),o("div",L,[o("div",W,[(l(!0),g(M,null,O(r($),(e,m)=>(l(),g("div",{class:Y(["answer-item",{user:e.role==="user",system:e.role==="assistant"}]),key:m},[o("div",X,[d(i,null,{default:f(()=>[e.role==="user"?(l(),w(r(G),{key:0})):(l(),w(r(H),{key:1}))]),_:2},1024)]),o("div",tt,F(e.content===""?"...":e.content),1)],2))),128))])])])}}},ut=B(nt,[["__scopeId","data-v-c730349e"]]);export{ut as default};
