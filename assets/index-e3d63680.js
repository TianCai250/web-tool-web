import{_ as M,C as P,r as R,a as B,B as U,D as V,t as O,b as f,o as n,d as i,e as c,f as g,u as l,i as A,w as y,F as Y,s as G,E as L,j as x,G as F,x as S,H as Q,I as Z,k as K}from"./index-023244de.js";import{m as v,H as W}from"./common-132caf81.js";const X={class:"ai-chat"},ee={class:"question-container"},te={class:"question-btn"},se={class:"answer-list"},oe={class:"answer-icon"},ne={key:0,class:"answer-words"},ae=["innerHTML"],le="a7f148b0",re="MzNjZDEzYjkxNTE5YjQ3MjU2YmZiNTUx",ie="a894f8068c0dced62fd3df07d48c91de",ce={__name:"index",setup(ue){const C=new v.Renderer;v.setOptions({renderer:C,gfm:!0,pedantic:!1,sanitize:!1,highlight:(s,o)=>o?W.highlight(s,{language:o}).value:s});const b=P().appContext.config.globalProperties.$CryptoJS,u=R(),e=B({question:"",list:[],status:"empty"});U(()=>{const s=H();if(s)try{e.list=JSON.parse(s)}catch(o){console.log(o)}});const k=V(()=>e.question.trim().length===0||["busy"].includes(e.status)),T=()=>{k.value||(e.status="busy",e.list.push({role:"user",content:e.question}),e.question="",w(),$().then(s=>{}))},$=()=>new Promise((s,o)=>{const d=new Date().toGMTString(),a="spark-api.xf-yun.com",_="/v3.5/chat";let t=`host: ${a}
date: ${d}
GET ${_} HTTP/1.1`,m=b.enc.Base64.stringify(b.HmacSHA256(t,re));const z=`api_key="${ie}", algorithm="hmac-sha256", headers="host date request-line", signature="${m}"`;let j=btoa(z);const D=`wss://${a}${_}?authorization=${j}&date=${encodeURIComponent(d)}&host=${a}`;let r=new WebSocket(D);r.onopen=function(){console.log("sock连接成功!!!!"),r.send(JSON.stringify({header:{app_id:le},parameter:{chat:{domain:"generalv3.5",temperature:.5,max_tokens:1024}},payload:{message:{text:e.list}}})),e.list.push({role:"assistant",content:""})},r.onerror=function(p){e.status="empty",console.log("error: ",p),L({type:"error",message:"网络异常"}),o(p)},r.onmessage=function(p){JSON.parse(p.data).payload.choices.text.forEach(J=>{e.list[e.list.length-1].content+=J.content})},r.onclose=function(){e.status="empty",w(),console.log(u.value.scrollHeight),u.value.scrollTop=u.value.scrollHeight,s(e.list)}}),E=()=>{e.list=[],I()},w=()=>{localStorage.setItem("web_tool_ai_chat",JSON.stringify(e.list))},H=()=>localStorage.getItem("web_tool_ai_chat"),I=()=>{localStorage.removeItem("web_tool_ai_chat")},{question:h,list:N,status:q}=O(e);return(s,o)=>{const d=f("el-input"),a=f("el-button"),_=f("el-icon");return n(),i("div",X,[c("div",ee,[g(d,{type:"textarea",rows:4,resize:"none",placeholder:"请开始您的对话",modelValue:l(h),"onUpdate:modelValue":o[0]||(o[0]=t=>A(h)?h.value=t:null),clearable:""},null,8,["modelValue"]),c("div",te,[g(a,{onClick:E,disabled:l(q)!=="empty"},{default:y(()=>[x("全新会话")]),_:1},8,["disabled"]),g(a,{type:"info",onClick:T,disabled:k.value},{default:y(()=>[x("发送")]),_:1},8,["disabled"])])]),c("div",{class:"answer-container",ref_key:"listRef",ref:u},[c("div",se,[(n(!0),i(Y,null,G(l(N),(t,m)=>(n(),i("div",{class:F(["answer-item",{user:t.role==="user",system:t.role==="assistant"}]),key:m},[c("div",oe,[g(_,null,{default:y(()=>[t.role==="user"?(n(),S(l(Q),{key:0})):(n(),S(l(Z),{key:1}))]),_:2},1024)]),t.role==="user"?(n(),i("div",ne,K(t.content),1)):(n(),i("div",{key:1,class:"answer-words",innerHTML:t.content===""?"正在生成回答...":l(v)(t.content)},null,8,ae))],2))),128))])],512)])}}},me=M(ce,[["__scopeId","data-v-e27ce3d6"]]);export{me as default};
