import{d as Ae,r as Te,a as Oe,t as De,b as Fe,e as w,f as E,w as P,u as U,i as Le,l as Ce,m as A,o as ue,n as Pe,y as ke,j as je,h as Ie,p as Me,q as Se,E as he,_ as We}from"./index-9fca570e.js";/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function de(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,a)}return t}function j(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?de(Object(t),!0).forEach(function(a){Ve(r,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):de(Object(t)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(t,a))})}return r}function He(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function me(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,ye(a.key),a)}}function ze(r,e,t){return e&&me(r.prototype,e),t&&me(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ve(r,e,t){return e=ye(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function I(){return I=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},I.apply(this,arguments)}function Ne(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var a=t.call(r,e||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function ye(r){var e=Ne(r,"string");return typeof e=="symbol"?e:String(e)}var we={exports:{}};(function(r){typeof window>"u"||function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,a=e.Blob&&function(){try{return!!new Blob}catch{return!1}}(),i=a&&e.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,u=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,c=(a||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(l){var s,f,h,v,d,o,b,m,y;if(s=l.match(u),!s)throw new Error("invalid data URI");for(f=s[2]?s[1]:"text/plain"+(s[3]||";charset=US-ASCII"),h=!!s[4],v=l.slice(s[0].length),h?d=atob(v):d=decodeURIComponent(v),o=new ArrayBuffer(d.length),b=new Uint8Array(o),m=0;m<d.length;m+=1)b[m]=d.charCodeAt(m);return a?new Blob([i?b:o],{type:f}):(y=new n,y.append(o),y.getBlob(f))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(l,s,f){var h=this;setTimeout(function(){f&&t.toDataURL&&c?l(c(h.toDataURL(s,f))):l(h.mozGetAsFile("blob",s))})}:t.toDataURL&&c&&(t.msToBlob?t.toBlob=function(l,s,f){var h=this;setTimeout(function(){(s&&s!=="image/png"||f)&&t.toDataURL&&c?l(c(h.toDataURL(s,f))):l(h.msToBlob(s))})}:t.toBlob=function(l,s,f){var h=this;setTimeout(function(){l(c(h.toDataURL(s,f)))})})),r.exports?r.exports=c:e.dataURLtoBlob=c}(window)})(we);var ve=we.exports,Ge=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},pe={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Xe=typeof window<"u"&&typeof window.document<"u",x=Xe?window:{},M=function(e){return e>0&&e<1/0},qe=Array.prototype.slice;function X(r){return Array.from?Array.from(r):qe.call(r)}var Ye=/^image\/.+$/;function G(r){return Ye.test(r)}function $e(r){var e=G(r)?r.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var xe=String.fromCharCode;function Ke(r,e,t){var a="",i;for(t+=e,i=e;i<t;i+=1)a+=xe(r.getUint8(i));return a}var Je=x.btoa;function ge(r,e){for(var t=[],a=8192,i=new Uint8Array(r);i.length>0;)t.push(xe.apply(null,X(i.subarray(0,a)))),i=i.subarray(a);return"data:".concat(e,";base64,").concat(Je(t.join("")))}function Qe(r){var e=new DataView(r),t;try{var a,i,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var u=e.byteLength,c=2;c+1<u;){if(e.getUint8(c)===255&&e.getUint8(c+1)===225){i=c;break}c+=1}if(i){var l=i+4,s=i+10;if(Ke(e,l,4)==="Exif"){var f=e.getUint16(s);if(a=f===18761,(a||f===19789)&&e.getUint16(s+2,a)===42){var h=e.getUint32(s+4,a);h>=8&&(n=s+h)}}}if(n){var v=e.getUint16(n,a),d,o;for(o=0;o<v;o+=1)if(d=n+o*12+2,e.getUint16(d,a)===274){d+=8,t=e.getUint16(d,a),e.setUint16(d,1,a);break}}}catch{t=1}return t}function Ze(r){var e=0,t=1,a=1;switch(r){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var et=/\.\d*(?:0|9){12}\d*$/;function be(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return et.test(r)?Math.round(r*e)/e:r}function k(r){var e=r.aspectRatio,t=r.height,a=r.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=M(a),u=M(t);if(n&&u){var c=t*e;(i==="contain"||i==="none")&&c>a||i==="cover"&&c<a?t=a/e:a=t*e}else n?t=a/e:u&&(a=t*e);return{width:a,height:t}}function tt(r){for(var e=X(new Uint8Array(r)),t=e.length,a=[],i=0;i+3<t;){var n=e[i],u=e[i+1];if(n===255&&u===218)break;if(n===255&&u===216)i+=2;else{var c=e[i+2]*256+e[i+3],l=i+c+2,s=e.slice(i,l);a.push(s),i=l}}return a.reduce(function(f,h){return h[0]===255&&h[1]===225?f.concat(h):f},[])}function at(r,e){var t=X(new Uint8Array(r));if(t[2]!==255||t[3]!==224)return r;var a=t[4]*256+t[5],i=[255,216].concat(e,t.slice(4+a));return new Uint8Array(i)}var rt=x.ArrayBuffer,N=x.FileReader,_=x.URL||x.webkitURL,it=/\.\w+$/,nt=x.Compressor,ot=function(){function r(e,t){He(this,r),this.file=e,this.exif=[],this.image=new Image,this.options=j(j({},pe),t),this.aborted=!1,this.result=null,this.init()}return ze(r,[{key:"init",value:function(){var t=this,a=this.file,i=this.options;if(!Ge(a)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=a.type;if(!G(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!_||!N){this.fail(new Error("The current browser does not support image compression."));return}rt||(i.checkOrientation=!1,i.retainExif=!1);var u=n==="image/jpeg",c=u&&i.checkOrientation,l=u&&i.retainExif;if(_&&!c&&!l)this.load({url:_.createObjectURL(a)});else{var s=new N;this.reader=s,s.onload=function(f){var h=f.target,v=h.result,d={},o=1;c&&(o=Qe(v),o>1&&I(d,Ze(o))),l&&(t.exif=tt(v)),c||l?!_||o>1?d.url=ge(v,n):d.url=_.createObjectURL(a):d.url=v,t.load(d)},s.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},s.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},s.onloadend=function(){t.reader=null},c||l?s.readAsArrayBuffer(a):s.readAsDataURL(a)}}},{key:"load",value:function(t){var a=this,i=this.file,n=this.image;n.onload=function(){a.draw(j(j({},t),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){a.fail(new Error("Aborted to load the image."))},n.onerror=function(){a.fail(new Error("Failed to load the image."))},x.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(x.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=i.name,n.src=t.url}},{key:"draw",value:function(t){var a=this,i=t.naturalWidth,n=t.naturalHeight,u=t.rotate,c=u===void 0?0:u,l=t.scaleX,s=l===void 0?1:l,f=t.scaleY,h=f===void 0?1:f,v=this.file,d=this.image,o=this.options,b=document.createElement("canvas"),m=b.getContext("2d"),y=Math.abs(c)%180===90,S=(o.resize==="contain"||o.resize==="cover")&&M(o.width)&&M(o.height),T=Math.max(o.maxWidth,0)||1/0,O=Math.max(o.maxHeight,0)||1/0,D=Math.max(o.minWidth,0)||0,F=Math.max(o.minHeight,0)||0,B=i/n,p=o.width,g=o.height;if(y){var q=[O,T];T=q[0],O=q[1];var Y=[F,D];D=Y[0],F=Y[1];var $=[g,p];p=$[0],g=$[1]}S&&(B=p/g);var K=k({aspectRatio:B,width:T,height:O},"contain");T=K.width,O=K.height;var J=k({aspectRatio:B,width:D,height:F},"cover");if(D=J.width,F=J.height,S){var Q=k({aspectRatio:B,width:p,height:g},o.resize);p=Q.width,g=Q.height}else{var Z=k({aspectRatio:B,width:p,height:g}),ee=Z.width;p=ee===void 0?i:ee;var te=Z.height;g=te===void 0?n:te}p=Math.floor(be(Math.min(Math.max(p,D),T))),g=Math.floor(be(Math.min(Math.max(g,F),O)));var Be=-p/2,Re=-g/2,Ee=p,Ue=g,W=[];if(S){var ae=0,re=0,H=i,z=n,ie=k({aspectRatio:B,width:i,height:n},{contain:"cover",cover:"contain"}[o.resize]);H=ie.width,z=ie.height,ae=(i-H)/2,re=(n-z)/2,W.push(ae,re,H,z)}if(W.push(Be,Re,Ee,Ue),y){var ne=[g,p];p=ne[0],g=ne[1]}b.width=p,b.height=g,G(o.mimeType)||(o.mimeType=v.type);var oe="transparent";v.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var se=o.mimeType==="image/jpeg";if(se&&(oe="#fff"),m.fillStyle=oe,m.fillRect(0,0,p,g),o.beforeDraw&&o.beforeDraw.call(this,m,b),!this.aborted&&(m.save(),m.translate(p/2,g/2),m.rotate(c*Math.PI/180),m.scale(s,h),m.drawImage.apply(m,[d].concat(W)),m.restore(),o.drew&&o.drew.call(this,m,b),!this.aborted)){var le=function(L){if(!a.aborted){var fe=function(C){return a.done({naturalWidth:i,naturalHeight:n,result:C})};if(L&&se&&o.retainExif&&a.exif&&a.exif.length>0){var ce=function(C){return fe(ve(ge(at(C,a.exif),o.mimeType)))};if(L.arrayBuffer)L.arrayBuffer().then(ce).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var R=new N;a.reader=R,R.onload=function(V){var C=V.target;ce(C.result)},R.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},R.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},R.onloadend=function(){a.reader=null},R.readAsArrayBuffer(L)}}else fe(L)}};b.toBlob?b.toBlob(le,o.mimeType,o.quality):le(ve(b.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(t){var a=t.naturalWidth,i=t.naturalHeight,n=t.result,u=this.file,c=this.image,l=this.options;if(_&&c.src.indexOf("blob:")===0&&_.revokeObjectURL(c.src),n)if(l.strict&&!l.retainExif&&n.size>u.size&&l.mimeType===u.type&&!(l.width>a||l.height>i||l.minWidth>a||l.minHeight>i||l.maxWidth<a||l.maxHeight<i))n=u;else{var s=new Date;n.lastModified=s.getTime(),n.lastModifiedDate=s,n.name=u.name,n.name&&n.type!==u.type&&(n.name=n.name.replace(it,$e(n.type)))}else n=u;this.result=n,l.success&&l.success.call(this,n)}},{key:"fail",value:function(t){var a=this.options;if(a.error)a.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=nt,r}},{key:"setDefaults",value:function(t){I(pe,t)}}]),r}();const _e=r=>(Me("data-v-734497ca"),r=r(),Se(),r),st={class:"image-compress"},lt=_e(()=>w("div",{class:"el-upload__text"},"拖拽或点击上传图片",-1)),ft={class:"parse-btn"},ct={class:"form"},ut={class:"parse-result"},ht=_e(()=>w("div",{class:"label"},"压缩结果",-1)),dt={class:"result"},mt=["src"],vt=Ae({__name:"index",setup(r){const e=Te(),t=Oe({fileList:[],result:"",form:{quality:.6}}),a=s=>{s&&(t.fileList=[s])},i=s=>{e.value.clearFiles();const f=s[0];f.uid=Ce(),e.value.handleStart(f)},n=()=>{if(!t.fileList.length){he({type:"info",message:"请上传图片"});return}let s=t.fileList[0].raw;new ot(s,{quality:t.form.quality,convertSize:1,success(f){let h=new FileReader;h.readAsDataURL(f),h.onload=v=>{t.result=h.result}},error(f){he({type:"error",message:"压缩失败"}),console.log(f.message)}})},{fileList:u,result:c,form:l}=De(t);return(s,f)=>{const h=A("el-icon"),v=A("el-upload"),d=A("el-input-number"),o=A("el-button"),b=A("el-form-item"),m=A("el-form");return ue(),Fe("div",st,[w("div",null,[E(v,{ref_key:"uploadRef",ref:e,drag:"",action:"","auto-upload":!1,accept:".jpg,.png,.jpeg,.webp","on-exceed":i,"on-change":a,limit:1,"file-list":U(u),"onUpdate:fileList":f[0]||(f[0]=y=>Le(u)?u.value=y:null)},{default:P(()=>[E(h,{class:"el-icon--upload"},{default:P(()=>[E(U(Pe))]),_:1}),lt]),_:1},8,["file-list"])]),w("div",ft,[w("div",ct,[E(m,{"label-wdith":"80px"},{default:P(()=>[E(b,{label:"压缩率："},{default:P(()=>[E(d,{modelValue:U(l).quality,"onUpdate:modelValue":f[1]||(f[1]=y=>U(l).quality=y),min:0,max:1},null,8,["modelValue"]),U(u).length?(ue(),ke(o,{key:0,style:{"margin-left":"0.3rem"},type:"info",onClick:n},{default:P(()=>[je("开始压缩")]),_:1})):Ie("",!0)]),_:1})]),_:1})])]),w("div",ut,[ht,w("div",dt,[w("img",{src:U(c),alt:""},null,8,mt)])])])}}});const bt=We(vt,[["__scopeId","data-v-734497ca"]]);export{bt as default};
