import{d as z,r as D,a as U,C as R,D as V,t as B,b as c,e as u,f as g,u as r,i as A,w as f,F as L,x as O,G as Y,E as F,m as y,o as n,j as x,H as G,y as w,I as Q,J as Z,k as K,_ as W}from"./index-9fca570e.js";import{M as X,m as ee,H as S}from"./github-fb06b0c3.js";const te={class:"ai-chat"},se={class:"question-container"},oe={class:"question-btn"},ne={class:"answer-list"},ae={class:"answer-icon"},le={key:0,class:"answer-words"},re=["innerHTML"],ie="a7f148b0",ce="MzNjZDEzYjkxNTE5YjQ3MjU2YmZiNTUx",ue="a894f8068c0dced62fd3df07d48c91de",de=z({__name:"index",setup(_e){const C=new X(ee({langPrefix:"hljs language-",highlight(s,o){const a=S.getLanguage(o)?o:"shell";return s&&S.highlight(s,{language:a}).value}})),b=Y().appContext.config.globalProperties.$CryptoJS,d=D(),e=U({question:"",list:[],status:"empty"});R(()=>{const s=E();if(s)try{e.list=JSON.parse(s)}catch(o){console.log(o)}});const v=V(()=>e.question.trim().length===0||["busy"].includes(e.status)),H=()=>{v.value||(e.status="busy",e.list.push({role:"user",content:e.question}),e.question="",k(),T().then(s=>{}))},T=()=>new Promise((s,o)=>{const a=new Date().toUTCString(),l="spark-api.xf-yun.com",_="/v3.5/chat";let t=`host: ${l}
date: ${a}
GET ${_} HTTP/1.1`,m=b.enc.Base64.stringify(b.HmacSHA256(t,ce));const q=`api_key="${ue}", algorithm="hmac-sha256", headers="host date request-line", signature="${m}"`;let J=btoa(q);const M=`wss://${l}${_}?authorization=${J}&date=${encodeURIComponent(a)}&host=${l}`;let i=new WebSocket(M);i.onopen=function(){console.log("sock连接成功!!!!"),i.send(JSON.stringify({header:{app_id:ie},parameter:{chat:{domain:"generalv3.5",temperature:.5,max_tokens:1024}},payload:{message:{text:e.list}}})),e.list.push({role:"assistant",content:""})},i.onerror=function(p){e.status="empty",console.log("error: ",p),F({type:"error",message:"网络异常"}),o(p)},i.onmessage=function(p){JSON.parse(p.data).payload.choices.text.forEach(P=>{e.list[e.list.length-1].content+=P.content})},i.onclose=function(){e.status="empty",k(),console.log(d.value.scrollHeight),d.value.scrollTop=d.value.scrollHeight,s(e.list)}}),$=()=>{e.list=[],I()},k=()=>{localStorage.setItem("web_tool_ai_chat",JSON.stringify(e.list))},E=()=>localStorage.getItem("web_tool_ai_chat"),I=()=>{localStorage.removeItem("web_tool_ai_chat")},{question:h,list:N,status:j}=B(e);return(s,o)=>{const a=y("el-input"),l=y("el-button"),_=y("el-icon");return n(),c("div",te,[u("div",se,[g(a,{type:"textarea",rows:4,resize:"none",placeholder:"请开始您的对话",modelValue:r(h),"onUpdate:modelValue":o[0]||(o[0]=t=>A(h)?h.value=t:null),clearable:""},null,8,["modelValue"]),u("div",oe,[g(l,{onClick:$,disabled:r(j)!=="empty"},{default:f(()=>[x("全新会话")]),_:1},8,["disabled"]),g(l,{type:"info",onClick:H,disabled:v.value},{default:f(()=>[x("发送")]),_:1},8,["disabled"])])]),u("div",{class:"answer-container",ref_key:"listRef",ref:d},[u("div",ne,[(n(!0),c(L,null,O(r(N),(t,m)=>(n(),c("div",{class:G(["answer-item",{user:t.role==="user",system:t.role==="assistant"}]),key:m},[u("div",ae,[g(_,null,{default:f(()=>[t.role==="user"?(n(),w(r(Q),{key:0})):(n(),w(r(Z),{key:1}))]),_:2},1024)]),t.role==="user"?(n(),c("div",le,K(t.content),1)):(n(),c("div",{key:1,class:"answer-words",innerHTML:t.content===""?"正在生成回答...":r(C).parse(t.content)},null,8,re))],2))),128))])],512)])}}});const ye=W(de,[["__scopeId","data-v-abdbb3f7"]]);export{ye as default};
